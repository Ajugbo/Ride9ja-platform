generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========== TABLES MATCHING YOUR SUPABASE DATABASE ==========

// 1. USERS TABLE (main user management - matches Supabase 'users' table)
model User {
  id           String    @id @default(uuid())
  email        String?   @unique @map("email")
  phone        String?   @unique @map("phone")
  name         String    @map("name")
  role         String    @default("RIDER") @map("role")
  passwordHash String?   @map("password_hash")
  verified     Boolean   @default(false) @map("verified")
  avatar       String?   @map("avatar")
  bio          String?   @map("bio")
  rating       Float?    @map("rating")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  // Relations
  vehicles      Vehicle[]
  tripsAsRider  Trip[]    @relation("RiderTrips")
  tripsAsDriver Trip[]?   @relation("DriverTrips")
  payments      Payment[]
  
  @@map("users")
}

// 2. VEHICLES TABLE (matches Supabase 'vehicles' table)
model Vehicle {
  id          String   @id @default(uuid())
  driverId    String   @map("driver_id")
  make        String   @map("make")
  model       String   @map("model")
  year        Int?     @map("year")
  plateNumber String   @unique @map("plate_number")
  color       String   @map("color")
  verified    Boolean  @default(false) @map("verified")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  // Relations
  driver User @relation(fields: [driverId], references: [id])
  
  @@map("vehicles")
  @@index([driverId])
}

// 3. TRIPS TABLE (matches Supabase 'trips' table)
model Trip {
  id           String   @id @default(uuid())
  riderId      String   @map("rider_id")
  driverId     String?  @map("driver_id")
  origin       String   @map("origin")
  destination  String   @map("destination")
  fare         Float?   @map("fare")
  status       String   @default("REQUESTED") @map("status")
  scheduledAt  DateTime? @map("scheduled_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  // Relations
  rider    User @relation("RiderTrips", fields: [riderId], references: [id])
  driver   User? @relation("DriverTrips", fields: [driverId], references: [id])
  payment  Payment?
  
  @@map("trips")
}

// 4. PAYMENTS TABLE (matches Supabase 'payments' table)
model Payment {
  id        String   @id @default(uuid())
  tripId    String   @map("trip_id")
  payerId   String   @map("payer_id")
  amount    Float    @map("amount")
  provider  String   @map("provider")
  status    String   @default("PENDING") @map("status")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  trip  Trip @relation(fields: [tripId], references: [id])
  payer User @relation(fields: [payerId], references: [id])
  
  @@map("payments")
}

// ========== ENUMS (Optional - you can use strings instead) ==========
// Note: Your Supabase uses strings, not enums, so we're using String type above
// If you want type safety, you can add these enums and change field types to enum

/*
enum UserRole {
  RIDER
  DRIVER
  ADMIN
}

enum TripStatus {
  REQUESTED
  ACCEPTED
  ONGOING
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}
*/
